<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>综合图表展示</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <script src="https://cdn.jsdelivr.net/npm/echarts@5/dist/echarts.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-image: url('bupt.png');
            background-size: 100%;
            background-attachment: fixed;
            background-position: center;
            background-repeat: no-repeat;
            color: white;
        }
        .iframe-container {
            width: 80%;
            height: 80vh;
            background: rgba(255, 255, 255, 0.8);
            border-radius: 10px;
            overflow: hidden;
            margin: 20px auto;
            position: relative;
        }
        .iframe-container iframe {
            width: 100%;
            height: 100%;
            border: none;
            display: none; /* Initially hide the iframe */
        }
        .title {
            position: absolute;
            top: 10px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.5);
            color: white;
            padding: 5px 10px;
            border-radius: 5px;
            font-size: 18px;
        }
        .small-frames-container {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            width: 80%;
            margin: 20px auto;
        }
        .small-frame {
            background: rgba(255, 255, 255, 0.8);
            border-radius: 10px;
            overflow: hidden;
            width: 45%;
            height: 600px;
            margin: 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            position: relative;
        }
        .small-frame .chart-container {
            width: 100%;
            height: 100%;
            margin: 0;
            display: none; /* Initially hide the chart containers */
        }
        .small-frame .title {
            top: 10px;
        }
        .small-frame .show-chart-btn, .iframe-container .show-chart-btn {
            position: absolute;
            bottom: 10px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.7);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <div class="iframe-container">
        <div class="title">热力图</div>
        <iframe src="heatmap_with_more_regions.html" id="heatmapIframe"></iframe>
        <button class="show-chart-btn" onclick="showIframe('heatmapIframe')">显示图表</button>
    </div>
    <div class="small-frames-container">
        <div class="small-frame">
            <div class="title">随时间分布图</div>
            <div id="chart1" class="chart-container"></div>
            <button class="show-chart-btn" onclick="showChart('chart1')">显示图表</button>
        </div>
        <div class="small-frame">
            <div class="title">词频图</div>
            <div id="chart2" class="chart-container"></div>
            <button class="show-chart-btn" onclick="showChart('chart2')">显示图表</button>
        </div>
        <div class="small-frame">
            <div class="title">IP属地图</div>
            <div id="chart3" class="chart-container"></div>
            <button class="show-chart-btn" onclick="showChart('chart3')">显示图表</button>
        </div>
        <div class="small-frame">
            <div class="title">情感分布图</div>
            <div id="chart4" class="chart-container"></div>
            <button class="show-chart-btn" onclick="showChart('chart4')">显示图表</button>
        </div>
        <div class="small-frame">
            <div class="title">词云图</div>
            <div id="wordCloud" class="chart-container">
                <img src="词云图.png" alt="词云图" style="width: 100%; height: 100%; object-fit: cover; border-radius: 10px;">
            </div>
            <button class="show-chart-btn" onclick="showChart('wordCloud')">显示图表</button>
        </div>
    </div>

    <script>
        function showIframe(iframeId) {
            document.getElementById(iframeId).style.display = 'block';
            document.querySelector(`#${iframeId} ~ .show-chart-btn`).style.display = 'none';
        }

        function showChart(chartId) {
            document.getElementById(chartId).style.display = 'block';
            document.querySelector(`#${chartId} ~ .show-chart-btn`).style.display = 'none';
            if (chartId !== 'wordCloud') {
                initChart(chartId);
            }
        }

        function initChart(chartId) {
            switch (chartId) {
                case 'chart1':
                    // Initialize chart1
                    var chart1 = echarts.init(document.getElementById('chart1'));

                    fetch('随时间分布图.json')
                        .then(response => response.json())
                        .then(data => {
                            var dates = Object.keys(data);
                            var values = Object.values(data);

                            var option1 = {
                                tooltip: {
                                    trigger: 'axis',
                                    backgroundColor: 'rgba(255, 255, 255, 0.8)',
                                    borderColor: '#ccc',
                                    borderWidth: 1,
                                    textStyle: {
                                        color: '#000'
                                    }
                                },
                                xAxis: {
                                    type: 'category',
                                    data: dates,
                                    boundaryGap: false
                                },
                                yAxis: {
                                    type: 'value'
                                },
                                series: [{
                                    data: values,
                                    type: 'line',
                                    smooth: true,
                                    animationDuration: 12000,
                                    areaStyle: {
                                        color: new echarts.graphic.LinearGradient(0, 0, 0, 1, [{
                                            offset: 0,
                                            color: 'rgba(55, 162, 255, 1)'
                                        }, {
                                            offset: 1,
                                            color: 'rgba(116, 21, 219, 0.1)'
                                        }])
                                    },
                                    markPoint: {
                                        data: [
                                            {type: 'max', name: '最大值'},
                                            {type: 'min', name: '最小值'}
                                        ],
                                        symbolSize: 60
                                    }
                                }]
                            };

                            chart1.setOption(option1);
                        })
                        .catch(error => console.error('Failed to load data:', error));
                    break;
                case 'chart2':
                    // Initialize chart2
                    var chart2 = echarts.init(document.getElementById('chart2'));
                    var colors = ['#FF6666', '#FFCC66', '#66CCFF', '#FF6699', '#66CC66', '#FF9966', '#6699CC', '#CC99CC'];

                    $.getJSON('词频图.json', function (data) {
                        var formattedData = {
                            name: 'root',
                            children: Object.keys(data).map((key, index) => ({
                                name: key,
                                value: data[key],
                                itemStyle: {
                                    color: colors[index % colors.length]
                                }
                            }))
                        };

                        const treemapOption = {
                            series: [{
                                type: 'treemap',
                                data: [formattedData],
                                label: {
                                    show: true,
                                    formatter: '{b}: {c}'
                                },
                                upperLabel: { show: false },
                                itemStyle: {
                                    borderColor: '#fff',
                                    borderWidth: 1,
                                    gapWidth: 1
                                },
                                transitionDuration: 1500,
                            }]
                        };

                        const roseOption = {
                            series: [{
                                type: 'pie',
                                radius: [20, 140],
                                roseType: 'radius',
                                data: formattedData.children,
                                label: {
                                    show: true,
                                    formatter: '{b}: {c} ({d}%)'
                                },
                                transitionDuration: 1500
                            }]
                        };

                        let currentOption = treemapOption;
                        chart2.setOption(currentOption);

                        setInterval(() => {
                            currentOption = currentOption === treemapOption ? roseOption : treemapOption;
                            chart2.setOption(currentOption);
                        }, 3000);
                    });
                    break;
                case 'chart3':
                    // Initialize chart3
                    var chart3 = echarts.init(document.getElementById('chart3'));

                    fetch('IP属地图.json')
                        .then(response => response.json())
                        .then(data => {
                            var categories = Object.keys(data);
                            var values = Object.values(data);

                            chart3.setOption({
                                tooltip: {
                                    trigger: 'item',
                                    formatter: '{a} <br/>{b} : {c} ({d}%)'
                                },
                                legend: {
                                    orient: 'vertical',
                                    left: 'left',
                                    top: 'center',
                                    textStyle: {
                                        fontSize: 12,
                                        color: '#34495e'
                                    }
                                },
                                series: [{
                                    name: '地区',
                                    type: 'pie',
                                    radius: ['30%', '50%'],
                                    avoidLabelOverlap: true,
                                    itemStyle: {
                                        borderRadius: 10,
                                        borderColor: '#fff',
                                        borderWidth: 2
                                    },

                                    emphasis: {
                                        itemStyle: {
                                            shadowBlur: 10,
                                            shadowOffsetX: 0,
                                            shadowColor: 'rgba(0, 0, 0, 0.5)'
                                        }
                                    },
                                    data: categories.map((category, index) => ({ name: category, value: values[index] }))
                                }],
                                backgroundColor: 'transparent'
                            });
                        })
                        .catch(error => {
                            console.error('获取情感分布数据出错：', error);
                        });
                    break;
                case 'chart4':
                    // Initialize chart4
                    var chart4 = echarts.init(document.getElementById('chart4'));

                    fetch('情感分布图.json')
                        .then(response => response.json())
                        .then(initChart4)
                        .catch(error => console.error('Failed to load JSON data:', error));

                    function initChart4(data) {
                        const categories = Object.keys(data);
                        const originalValues = Object.values(data);

                        const randomIndices = [...Array(categories.length).keys()].sort(() => Math.random() - 0.5);
                        const shuffledCategories = randomIndices.map(index => categories[index]);
                        const shuffledValues = randomIndices.map(index => originalValues[index]);
                        const currentValues = Array(shuffledValues.length).fill(0);

                        const colors = ['#c23531', '#2f4554', '#61a0a8', '#d48265', '#91c7ae', '#749f83'];

                        var option4 = {
                            xAxis: {
                                max: 'dataMax',
                                axisLabel: {
                                    formatter: function (value) {
                                        return value.toFixed(0);
                                    }
                                }
                            },
                            yAxis: {
                                type: 'category',
                                data: shuffledCategories,
                                inverse: true,
                                animationDuration: 300,
                                animationDurationUpdate: 300,
                                max: shuffledCategories.length - 1
                            },
                            series: [{
                                realtimeSort: true,
                                type: 'bar',
                                data: currentValues,
                                label: {
                                    show: true,
                                    position: 'right',
                                    valueAnimation: true
                                },
                                itemStyle: {
                                    color: function (params) {
                                        return colors[params.dataIndex % colors.length];
                                    }
                                }
                            }],
                            legend: {
                                show: true
                            },
                            animationDuration: 0,
                            animationDurationUpdate: 1000,
                            animationEasing: 'linear',
                            animationEasingUpdate: 'linear'
                        };

                        chart4.setOption(option4);

                        function run() {
                            let done = true;
                            const totalDuration = 8000;
                            const updateInterval = 100;
                            const totalSteps = totalDuration / updateInterval;

                            for (let i = 0; i < currentValues.length; i++) {
                                if (currentValues[i] < shuffledValues[i]) {
                                    const increment = Math.ceil((shuffledValues[i] - currentValues[i]) / totalSteps);
                                    currentValues[i] += increment > 0 ? increment : 1;
                                    if (currentValues[i] > shuffledValues[i]) {
                                        currentValues[i] = shuffledValues[i];
                                    }
                                    done = false;
                                }
                            }

                            chart4.setOption({
                                series: [{
                                    data: currentValues
                                }]
                            });

                            if (done) {
                                clearInterval(intervalId);

                                const sortedIndices = [...Array(currentValues.length).keys()].sort((a, b) => currentValues[b] - currentValues[a]);
                                const sortedCategories = sortedIndices.map(index => shuffledCategories[index]);
                                const sortedValues = sortedIndices.map(index => currentValues[index]);

                                option4.xAxis.max = Math.max(...sortedValues);
                                option4.yAxis.data = sortedCategories;
                                option4.series[0].data = sortedValues;
                                option4.series[0].itemStyle = {
                                    color: function (params) {
                                        return colors[params.dataIndex % colors.length];
                                    }
                                };

                                option4.animationDurationUpdate = 0;
                                option4.series[0].realtimeSort = false;
                                chart4.setOption(option4, true);
                            }
                        }

                        setTimeout(run, 0);
                        var intervalId = setInterval(run, 100);
                    }
                    break;
            }
        }
    </script>
</body>
</html>

